<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=5, user-scalable=yes" />
<title>Big Time Clock — Final</title>

<link href="https://fonts.googleapis.com/css2?family=Modak&display=swap" rel="stylesheet">
  
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">
<meta name="apple-mobile-web-app-capable" content="yes">

<style>
  :root{
    --ghost-bg: rgba(255,255,255,0.18);
    --ghost-small-bg: rgba(255,255,255,0.12);
  }

  * {
    box-sizing: border-box;
  }

  html {
    /* Ensure proper scaling on high DPI displays */
    -webkit-text-size-adjust: 100%;
    -moz-text-size-adjust: 100%;
    -ms-text-size-adjust: 100%;
    text-size-adjust: 100%;
  }

  body {
    margin: 0;
    height: 100vh;
    min-height: 100vh;
    width: 100vw;
    background: black;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: 'Modak', cursive;
    overflow: hidden;
    position: relative;
  }

  .clock {
    font-size: 20.8vw;
    display: flex;
    gap: 0.04em;
    align-items: center;
    padding: 0 2.5vw;
    overflow: visible;
    line-height: 1;
    /* Ensure clock scales properly on all displays */
    max-width: 95vw;
    text-align: center;
  }

  /* PORTRAIT MODE */
  .clock.portrait-mode {
    flex-direction: column;
    font-size: 38vw;
    gap: 0;
    padding: 0;
    max-width: 100vw;
  }

  /* Media query for high DPI displays (like 200% scaling) */
  @media (min-resolution: 192dpi) {
    .clock {
      font-size: 19.5vw;
    }
    .clock.portrait-mode {
      font-size: 36vw;
    }
  }

  /* Additional support for very high resolution displays */
  @media (min-width: 2400px) {
    .clock {
      font-size: 18vw;
    }
    .clock.portrait-mode {
      font-size: 34vw;
    }
  }

  .clock.portrait-mode #main-colon {
    display: none;
  }

  .clock.portrait-mode #seconds-block {
    display: none !important;
  }

  #seconds-block { display: inline-flex; }

  .pulse {
    animation: pulse 1s linear infinite;
  }

  @keyframes pulse {
    0% { opacity: 1; transform: scale(1); }
    60% { opacity: 0; transform: scale(0.85); }
    100% { opacity: 1; transform: scale(1); }
  }

  .hide-seconds #seconds-block { display: none; }

  /* GHOST BUTTONS */
  .ghost {
    position: fixed;
    width: 30px;
    height: 30px;
    background: var(--ghost-bg);
    border-radius: 50%;
    cursor: pointer;
    z-index: 120;
    /* Ensure touch targets are accessible on high DPI */
    min-width: 30px;
    min-height: 30px;
  }

  @media (min-resolution: 192dpi) {
    .ghost {
      width: 36px;
      height: 36px;
      min-width: 36px;
      min-height: 36px;
    }
    #ghost-color {
      width: 32px !important;
      height: 32px !important;
      min-width: 32px !important;
      min-height: 32px !important;
    }
  }

  #ghost-seconds { left: 18px; bottom: 18px; }
  #ghost-pro { top: 18px; left: 18px; }

  /* ✔ FIXED — COLOR BUTTON IN BOTTOM RIGHT */
  #ghost-color {
    position: fixed;
    right: 18px;
    bottom: 18px;
    width: 26px;
    height: 26px;
    background: var(--ghost-small-bg);
    border-radius: 50%;
    cursor: pointer;
    z-index: 130;
  }

  /* Color Menu */
  #color-menu {
    position: fixed;
    right: 18px;
    bottom: 64px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.25s ease;
    z-index: 140;
  }
  #color-menu.active { opacity: 1; pointer-events: auto; }

  .color-dot {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: 2px solid rgba(255,255,255,0.42);
    cursor: pointer;
    min-width: 36px;
    min-height: 36px;
  }

  @media (min-resolution: 192dpi) {
    .color-dot {
      width: 42px;
      height: 42px;
      min-width: 42px;
      min-height: 42px;
    }
  }

  /* Pro menu */
  #pro-panel {
    position: fixed;
    left: 18px;
    top: 64px;
    width: 260px;
    max-width: calc(100vw - 40px);
    padding: 12px;
    border-radius: 10px;
    background: rgba(255,255,255,0.05);
    backdrop-filter: blur(7px);
    font-family: Helvetica, Arial, sans-serif;
    color: #fff;
    font-size: 14px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.18s ease;
    z-index: 150;
    box-sizing: border-box;
  }

  @media (min-resolution: 192dpi) {
    #pro-panel {
      width: 300px;
      font-size: 15px;
      padding: 14px;
    }
  }

  #pro-panel.active { opacity: 1; pointer-events: auto; }

  .pro-row {
    margin: 10px 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  /* Apple style toggle */
  .toggle-circle {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    border: 2px solid white;
    cursor: pointer;
    position: relative;
    min-width: 18px;
    min-height: 18px;
    flex-shrink: 0;
  }
  .toggle-circle.active::after {
    content: "";
    position: absolute;
    top: 3px;
    left: 3px;
    width: 10px;
    height: 10px;
    background: white;
    border-radius: 50%;
  }

  @media (min-resolution: 192dpi) {
    .toggle-circle {
      width: 22px;
      height: 22px;
      min-width: 22px;
      min-height: 22px;
    }
    .toggle-circle.active::after {
      top: 4px;
      left: 4px;
      width: 12px;
      height: 12px;
    }
  }
  #freeze-zone {
    position: fixed;
    bottom: 140px;
    left: 20px;
    width: 120px;
    height: 120px;
    z-index: 200;
    background: transparent;
  }

  @media (min-resolution: 192dpi) {
    #freeze-zone {
      width: 140px;
      height: 140px;
    }
  }

  /* Ensure buttons and interactive elements are properly sized */
  button, a {
    min-height: 32px;
    padding: 6px 12px;
    cursor: pointer;
  }

  @media (min-resolution: 192dpi) {
    button, a {
      min-height: 36px;
      padding: 8px 14px;
    }
  }

</style>
</head>
<body>

<!-- CLOCK -->
<div class="clock" id="clock">
  <span id="hours">00</span>
  <span id="main-colon">:</span>
  <span id="minutes">00</span>
  <span id="seconds-block">
    <span id="sec-colon">:</span>
    <span id="seconds">00</span>
  </span>
</div>

<!-- GHOST BUTTONS -->
<div id="ghost-pro" class="ghost"></div>
<div id="ghost-seconds" class="ghost"></div>
<div id="ghost-color"></div>

 <!-- FREEZE ZONE --> 
<div id="freeze-zone"></div>

  
<!-- COLOR MENU -->
<div id="color-menu">
  <div class="color-dot" data-color="#fff" data-bg="#000" style="background:#fff"></div>
  <div class="color-dot" data-color="#000" data-bg="#fff" style="background:#000"></div>
  <div class="color-dot" data-color="#00eaff" data-bg="#00141a" style="background:#00eaff"></div>
  <div class="color-dot" data-color="#39ff14" data-bg="#061a00" style="background:#39ff14"></div>
  <div class="color-dot" data-color="#ff0077" data-bg="#1a0010" style="background:#ff0077"></div>
  <div class="color-dot" data-color="#ff9100" data-bg="#1a0d00" style="background:#ff9100"></div>
  <div class="color-dot" data-color="#b400ff" data-bg="#15001a" style="background:#b400ff"></div>
</div>

<!-- PRO MENU -->
<div id="pro-panel">
  <h4>Settings</h4>

  <div class="pro-row">
    <div>12-Hour Format</div>
    <div id="toggle12" class="toggle-circle"></div>
  </div>

  <div class="pro-row">
    <div>Portrait Mode</div>
    <div id="togglePortrait" class="toggle-circle"></div>
  </div>

  <h4>Pro Features</h4>
  <div class="pro-row"><div>Pro Color Palettes</div><button>Preview</button></div>
  <div class="pro-row"><div>Glass-Morphism</div><button>Preview</button></div>
  <div class="pro-row"><div>Buy Me a Coffee</div><a href="https://buymeacoffee.com" target="_blank">Buy</a></div>
</div>

<script>

if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js");
}


/* CLOCK */
// RESTORE ALL SETTINGS FIRST
let use24h = localStorage.getItem("use24h") !== "false";
let secondsOn = localStorage.getItem("secondsOn") !== "false";
let portraitMode = localStorage.getItem("portraitMode") === "true";

const savedColor = localStorage.getItem("clockColor");
const savedBg = localStorage.getItem("clockBg");
if (savedColor && savedBg) {
  document.body.style.color = savedColor;
  document.body.style.background = savedBg;
}
  
/* turn this on to make screenshots */
let screenshotMode = false;
    
/* frozen clock logic */
let frozen = false;
let frozenTime = null;

const hoursEl = document.getElementById("hours");
const minutesEl = document.getElementById("minutes");
const secondsEl = document.getElementById("seconds");
const mainColon = document.getElementById("main-colon");
const clockEl = document.getElementById("clock");

function updateClock(){
  const now = frozen && frozenTime ? frozenTime : new Date();

  let h = now.getHours();
  let m = now.getMinutes();
  let s = now.getSeconds();

  if (!use24h) h = (h % 12) || 12;

  // NO LEADING ZERO FOR HOURS
  hoursEl.textContent = String(h);
  minutesEl.textContent = String(m).padStart(2,"0");
  secondsEl.textContent = String(s).padStart(2,"0");
}

setInterval(updateClock, 1000);
updateClock();

/* SECONDS ANIMATION */
function applyAnimations(){
  
  if (frozen) {
    // nothing should pulse in freeze mode
    secondsEl.classList.remove("pulse");
    mainColon.classList.remove("pulse");
    return;
  }
  
  if (secondsOn){
    clockEl.classList.remove("hide-seconds");
    mainColon.classList.remove("pulse");
    secondsEl.classList.add("pulse");
  } else {
    clockEl.classList.add("hide-seconds");
    secondsEl.classList.remove("pulse");
    mainColon.classList.add("pulse");
  }
}

/* PORTRAIT MODE */
function applyPortraitMode(){
  if (portraitMode) {
    clockEl.classList.add("portrait-mode");
  } else {
    clockEl.classList.remove("portrait-mode");
  }
}

applyAnimations();
applyPortraitMode();


/* BUTTONS */
document.getElementById("ghost-seconds").addEventListener("click",()=>{
  secondsOn = !secondsOn;
  localStorage.setItem("secondsOn", secondsOn);
  applyAnimations();
});

/* COLOR MENU */
const ghostColorBtn = document.getElementById("ghost-color");
const colorMenuEl = document.getElementById("color-menu");

ghostColorBtn.addEventListener("click",()=>{
  colorMenuEl.classList.add("active");
  clearTimeout(window.cm);
  window.cm = setTimeout(()=>colorMenuEl.classList.remove("active"), 5000);
});

document.querySelectorAll(".color-dot").forEach(dot=>{
  dot.addEventListener("click",()=>{
    document.body.style.color = dot.dataset.color;
    document.body.style.background = dot.dataset.bg;

    localStorage.setItem("clockColor", dot.dataset.color);
    localStorage.setItem("clockBg", dot.dataset.bg);
    
    colorMenuEl.classList.remove("active");
  });
});

/* PRO MENU */
const ghostProBtn = document.getElementById("ghost-pro");
const proPanelEl = document.getElementById("pro-panel");

ghostProBtn.addEventListener("click",()=>{
  proPanelEl.classList.toggle("active");
});

/* CLOSE PRO PANEL */
document.addEventListener("click",(e)=>{
  if (!proPanelEl.contains(e.target) && !ghostProBtn.contains(e.target)){
    proPanelEl.classList.remove("active");
  }
});

/* 12/24 TOGGLE */
const toggle12 = document.getElementById("toggle12");

if (!use24h) toggle12.classList.add("active");

toggle12.addEventListener("click",()=>{
  use24h = !use24h;
  localStorage.setItem("use24h", use24h);
  toggle12.classList.toggle("active");
  updateClock();
});

/* PORTRAIT MODE TOGGLE */
const togglePortrait = document.getElementById("togglePortrait");

if (portraitMode) togglePortrait.classList.add("active");

togglePortrait.addEventListener("click",()=>{
  portraitMode = !portraitMode;
  localStorage.setItem("portraitMode", portraitMode);
  togglePortrait.classList.toggle("active");
  applyPortraitMode();
});

document.getElementById("freeze-zone").addEventListener("click", () => {
  if (!screenshotMode) return;
  const input = prompt("Freeze time (HH:MM:SS)");
  if (!input || !/^\d\d[:\s]\d\d[:\s]\d\d$/.test(input)) return;

  const [h, m, s] = input.split(/[:\s]/).map(Number);

  const custom = new Date();
  custom.setHours(h, m, s, 0);

  frozen = true;
  frozenTime = custom;

  secondsEl.classList.remove("pulse");
  mainColon.classList.remove("pulse");

  updateClock();
});

document.getElementById("freeze-zone").addEventListener("dblclick", () => {
  if (!screenshotMode) return;
  frozen = false;
  frozenTime = null;
  applyAnimations();
});

</script>

</body>
</html>
